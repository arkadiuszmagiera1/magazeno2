<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optymalizacja ciƒôcia KVH i BSH</title>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #0e0e0e;
    color: #f0f0f0;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }

  .container {
    max-width: 800px;
    width: 100%;
    padding: 40px 20px;
  }

  h2 {
    text-align: center;
    margin-bottom: 10px;
  }

  .back-btn {
    display: block;
    margin: 20px auto 30px auto;
    background: #2d2d2d;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    cursor: pointer;
    transition: 0.3s;
  }

  .back-btn:hover {
    background: #444;
  }

  p, pre {
    font-size: 14px;
    line-height: 1.5;
  }

  pre {
    background: #1a1a1a;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #333;
    overflow-x: auto;
  }

  textarea {
    width: 100%;
    height: 160px;
    padding: 10px;
    border: 1px solid #333;
    border-radius: 8px;
    background: #1a1a1a;
    color: #f0f0f0;
    font-size: 15px;
    resize: vertical;
  }

  button {
    margin-top: 15px;
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    background: #2d2d2d;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: #444;
  }

  .result {
    margin-top: 20px;
    white-space: pre-wrap;
    background: #1a1a1a;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #333;
  }

  footer {
    margin-top: 30px;
    text-align: center;
    font-size: 13px;
    opacity: 0.6;
  }
</style>
</head>
<body>

<div class="container">
  <h2>ü™µ Optymalizacja ciƒôcia KVH i BSH</h2>
  <button class="back-btn" onclick="goBack()">‚Üê Powr√≥t do pulpitu</button>

  <p><strong>Wpisz dane</strong> ‚Äî <em>oddziel d≈Çugo≈õci ≈õrednikiem `;`</em>. Przecinek lub kropka oznacza czƒô≈õƒá dziesiƒôtnƒÖ, np. <code>6,45</code> lub <code>4.3</code>.</p>
  <p>Mo≈ºesz podaƒá ilo≈õƒá sztuk, np. <code>7x1,5</code> lub <code>8sztukx3</code> ‚Äî program przeliczy to automatycznie.</p>

  <p>Przyk≈Çad:</p>
  <pre>
60x120 BSH - 4,3;5;4,3;2,8;4,9;5,5;2,1
80x120 KVH - 2,1;4,5;8,9;7,8;6,45;7,2
100x120 BSH - 6,1;7,3;5,4;1,5;7x1,5;8sztukx3
  </pre>

  <textarea id="inputData" placeholder="Wpisz zestawienia ciƒôƒá..."></textarea>
  <button onclick="calculate()">Oblicz optymalizacjƒô</button>

  <div class="result" id="result"></div>
  <footer>Wersja 1.2 wykonana przez #ar_mag</footer>
</div>

<script>
// üîô Powr√≥t do pulpitu bez utraty sesji
function goBack() {
  window.location.href = "index.html";
}

function parseInput(input) {
  const lines = input.split('\n').map(l => l.trim()).filter(Boolean);
  const materials = [];

  for (let line of lines) {
    const match = line.match(/(\d+x\d+)\s*(BSH|KVH)\s*-\s*(.*)/i);
    if (!match) continue;

    const cross = match[1];
    const type = match[2].toUpperCase();
    const lengthsText = match[3];
    let lengths = [];

    const items = lengthsText.split(';').map(x => x.trim()).filter(Boolean);

    for (let item of items) {
      const multiMatch = item.match(/(\d+)\s*(szt|sztuk)?\s*[xX]\s*([\d.,]+)/i);
      if (multiMatch) {
        const count = parseInt(multiMatch[1]);
        const val = parseFloat(multiMatch[3].replace(',', '.'));
        for (let i = 0; i < count; i++) lengths.push(val);
        continue;
      }

      const singleMatch = item.match(/([\d.,]+)/);
      if (singleMatch) {
        const val = parseFloat(singleMatch[1].replace(',', '.'));
        if (!isNaN(val)) lengths.push(val);
      }
    }

    materials.push({ type, cross, lengths });
  }
  return materials;
}

function optimizeCuts(materialType, lengths) {
  const stockLengths = materialType === 'BSH' ? [12.0, 6.0] : [13.0, 6.5];
  const cuts = [];
  const sorted = [...lengths].sort((a, b) => b - a);

  for (let len of sorted) {
    let placed = false;
    for (let c of cuts) {
      if (c.remaining >= len) {
        c.pieces.push(len);
        c.remaining -= len;
        placed = true;
        break;
      }
    }
    if (!placed) {
      for (let stock of stockLengths) {
        if (stock >= len) {
          cuts.push({ stock, remaining: stock - len, pieces: [len] });
          break;
        }
      }
    }
  }
  return cuts;
}

function calculate() {
  const input = document.getElementById('inputData').value.trim();
  const resultDiv = document.getElementById('result');
  resultDiv.textContent = '';

  if (!input) {
    resultDiv.textContent = '‚ö†Ô∏è Wpisz dane do analizy.';
    return;
  }

  const materials = parseInput(input);
  if (materials.length === 0) {
    resultDiv.textContent = '‚ùå Nie wykryto danych w poprawnym formacie.';
    return;
  }

  let output = '';
  let globalCuts = 0, globalLength = 0, globalStock = 0, globalWaste = 0, globalBeams = 0;

  for (let mat of materials) {
    const cuts = optimizeCuts(mat.type, mat.lengths);
    const totalCut = mat.lengths.reduce((a, b) => a + b, 0);
    const totalStock = cuts.reduce((a, c) => a + c.stock, 0);
    const totalWaste = cuts.reduce((a, c) => a + c.remaining, 0);
    const totalCuts = mat.lengths.length;

    globalCuts += totalCuts;
    globalLength += totalCut;
    globalStock += totalStock;
    globalWaste += totalWaste;
    globalBeams += cuts.length;

    output += `üîπ ${mat.cross} ${mat.type}\n`;
    output += `  D≈Çugo≈õci: ${mat.lengths.map(x => x.toFixed(2) + 'm').join(', ')}\n`;
    output += `  Potrzebne belki: ${cuts.length}\n`;
    output += `  Ilo≈õƒá ciƒôƒá: ${totalCuts}\n\n`;

    cuts.forEach((c, i) => {
      output += `  Belka ${i + 1} (${c.stock.toFixed(2)} m): ciƒôcia: ${c.pieces.map(x => x.toFixed(2) + 'm').join(', ')} | odpad: ${c.remaining.toFixed(2)} m\n`;
    });

    output += `\n  Suma dociƒôtych d≈Çugo≈õci: ${totalCut.toFixed(2)} m\n`;
    output += `  Suma dostƒôpnych d≈Çugo≈õci (belki): ${totalStock.toFixed(2)} m\n`;
    output += `  Suma odpad√≥w: ${totalWaste.toFixed(2)} m\n\n`;
  }

  output += `\n=========================\n`;
  output += `üìä PODSUMOWANIE GLOBALNE\n`;
  output += `=========================\n`;
  output += `üî∏ ≈ÅƒÖczna ilo≈õƒá ciƒôƒá: ${globalCuts}\n`;
  output += `üî∏ ≈ÅƒÖczna d≈Çugo≈õƒá ciƒôƒá: ${globalLength.toFixed(2)} m\n`;
  output += `üî∏ ≈ÅƒÖczna ilo≈õƒá belek: ${globalBeams}\n`;
  output += `üî∏ ≈ÅƒÖczny odpad: ${globalWaste.toFixed(2)} m\n`;

  resultDiv.textContent = output.trim();
}

document.getElementById('inputData').addEventListener('input', () => {
  calculate();
});
</script>
</body>
</html>
