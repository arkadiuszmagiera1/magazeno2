<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optymalizacja ciÄ™cia drewna</title>
<style>
  :root {
    --bg-color: #ffffff;
    --text-color: #111111;
    --input-bg: #f5f5f5;
    --accent-color: #444;
  }

  body.dark {
    --bg-color: #121212;
    --text-color: #f0f0f0;
    --input-bg: #1e1e1e;
    --accent-color: #888;
  }

  body {
    font-family: 'Inter', 'Segoe UI', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }

  .container {
    max-width: 700px;
    width: 100%;
    padding: 30px;
  }

  h2 {
    text-align: center;
    margin-bottom: 10px;
  }

  p, pre {
    font-size: 14px;
    line-height: 1.5;
  }

  pre {
    background: var(--input-bg);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid var(--accent-color);
  }

  textarea {
    width: 100%;
    height: 160px;
    padding: 10px;
    border: 1px solid var(--accent-color);
    border-radius: 8px;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 15px;
  }

  button {
    margin-top: 15px;
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    background: #2d2d2d;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover {
    background: #444;
  }

  .result {
    margin-top: 20px;
    white-space: pre-wrap;
    background: var(--input-bg);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid var(--accent-color);
  }

  .theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .toggle-track {
    width: 50px;
    height: 26px;
    background-color: #ccc;
    border-radius: 20px;
    position: relative;
    transition: background 0.3s;
  }

  .toggle-thumb {
    width: 22px;
    height: 22px;
    background-color: white;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: all 0.3s;
  }

  body.dark .toggle-track {
    background-color: #666;
  }

  body.dark .toggle-thumb {
    transform: translateX(24px);
    background-color: #f0f0f0;
  }

  .label {
    margin-right: 10px;
    font-size: 14px;
  }

  footer {
    margin-top: 30px;
    text-align: center;
    font-size: 13px;
    opacity: 0.6;
  }
</style>
</head>
<body>

<div class="theme-toggle" onclick="toggleTheme()">
  <span class="label">ðŸŒž/ðŸŒ™</span>
  <div class="toggle-track">
    <div class="toggle-thumb"></div>
  </div>
</div>

<div class="container">
  <h2>ðŸªµ Optymalizacja ciÄ™cia drewna</h2>
  <p><strong>Wpisz dane</strong> â€” <em>oddziel dÅ‚ugoÅ›ci Å›rednikiem `;`</em>; przecinek (lub kropka) to czÄ™Å›Ä‡ dziesiÄ™tna, np. <code>6,45</code> lub <code>4.3</code>.</p>
  <p>MoÅ¼esz podaÄ‡ iloÅ›Ä‡ sztuk, np. <code>7x1,5</code> - gdzie pierwsza liczba w tym przypadku 7 to iloÅ›Ä‡ sztuk a druga wartoÅ›Ä‡ to dÅ‚ugoÅ›Ä‡ materiaÅ‚u â€” program przeliczy to automatycznie.</p>
  <pre>
60x120 BSH - 3,5;7x1,25;8x4,2
80x120 KVH - 3x5,1;4x3;2x2,5
  </pre>
  <textarea id="inputData" placeholder="Wpisz zestawienia ciÄ™Ä‡..."></textarea>
  <button onclick="calculate()">Oblicz optymalizacjÄ™</button>
  <div class="result" id="result"></div>
  <footer>Wersja 1.4 stworzone przez #ar_mag</footer>
</div>

<script>
function toggleTheme() {
  document.body.classList.toggle('dark');
}

function parseInput(input) {
  const lines = input.split('\n').map(l => l.trim()).filter(Boolean);
  const materials = [];

  for (let line of lines) {
    const match = line.match(/(\d+x\d+)\s*(BSH|KVH)\s*-\s*(.*)/i);
    if (!match) continue;

    const cross = match[1];
    const type = match[2].toUpperCase();
    const lengthsText = match[3];
    let lengths = [];

    const items = lengthsText.split(';').map(x => x.trim()).filter(Boolean);

    for (let item of items) {
      const multiMatch = item.match(/(\d+[.,]?\d*)\s*[xX]\s*(\d+[.,]?\d*)/);
      const reversedMatch = item.match(/(\d+[.,]?\d*)\s*[xX]\s*(\d+[.,]?\d*)/);

      if (multiMatch) {
        const count = parseFloat(multiMatch[1].replace(',', '.'));
        const val = parseFloat(multiMatch[2].replace(',', '.'));
        for (let i = 0; i < count; i++) lengths.push(val);
        continue;
      } else {
        const reversed = item.match(/(\d+[.,]?\d*)\s*[xX]\s*(\d+[.,]?\d*)/);
        if (reversed) {
          const val = parseFloat(reversed[1].replace(',', '.'));
          const count = parseFloat(reversed[2].replace(',', '.'));
          for (let i = 0; i < count; i++) lengths.push(val);
          continue;
        }
      }

      const singleMatch = item.match(/([\d.,]+)/);
      if (singleMatch) {
        const val = parseFloat(singleMatch[1].replace(',', '.'));
        if (!isNaN(val)) lengths.push(val);
      }
    }

    materials.push({ type, cross, lengths });
  }
  return materials;
}

function optimizeCuts(materialType, lengths) {
  const stockMain = materialType === 'BSH' ? 12.0 : 13.0;
  const stockAlt = materialType === 'BSH' ? 6.0 : 6.5;

  const cuts = [];
  const sorted = [...lengths].sort((a, b) => b - a);

  for (let len of sorted) {
    let placed = false;
    for (let c of cuts) {
      if (c.remaining >= len - 0.001) {
        c.pieces.push(len);
        c.remaining -= len;
        placed = true;
        break;
      }
    }
    if (!placed) {
      cuts.push({ stock: stockMain, remaining: stockMain - len, pieces: [len] });
    }
  }

  const converted = [];
  for (let c of cuts) {
    if (c.remaining >= stockAlt && c.remaining < c.stock) {
      converted.push({ stock: stockAlt, remaining: stockAlt - (c.stock - c.remaining), pieces: [...c.pieces] });
    } else {
      converted.push(c);
    }
  }

  return converted;
}

function calculate() {
  const input = document.getElementById('inputData').value.trim();
  const resultDiv = document.getElementById('result');
  resultDiv.textContent = '';

  if (!input) {
    resultDiv.textContent = 'âš ï¸ Wpisz dane do analizy.';
    return;
  }

  const materials = parseInput(input);
  if (materials.length === 0) {
    resultDiv.textContent = 'âŒ Nie wykryto danych w poprawnym formacie.';
    return;
  }

  let output = '';
  let globalCuts = 0, globalLength = 0, globalStock = 0, globalWaste = 0, globalBeams = 0;

  for (let mat of materials) {
    const cuts = optimizeCuts(mat.type, mat.lengths);
    const totalCut = mat.lengths.reduce((a, b) => a + b, 0);
    const totalStock = cuts.reduce((a, c) => a + c.stock, 0);
    const totalWaste = cuts.reduce((a, c) => a + c.remaining, 0);
    const totalCuts = mat.lengths.length;

    globalCuts += totalCuts;
    globalLength += totalCut;
    globalStock += totalStock;
    globalWaste += totalWaste;
    globalBeams += cuts.length;

    output += `ðŸ”¹ ${mat.cross} ${mat.type}\n`;
    output += `  DÅ‚ugoÅ›ci: ${mat.lengths.map(x => x.toFixed(2) + 'm').join(', ')}\n`;
    output += `  Potrzebne belki: ${cuts.length}  â†’  ${cuts.filter(c=>c.stock===12||c.stock===13).length}Ã—${mat.type==='BSH'?'12m':'13m'} + ${cuts.filter(c=>c.stock!==12&&c.stock!==13).length}Ã—${mat.type==='BSH'?'6m':'6,5m'}\n`;
    output += `  IloÅ›Ä‡ ciÄ™Ä‡: ${totalCuts}\n\n`;

    cuts.forEach((c, i) => {
      output += `  Belka ${i + 1} (${c.stock.toFixed(2)} m): ciÄ™cia: ${c.pieces.map(x => x.toFixed(2) + 'm').join(', ')} | odpad: ${c.remaining.toFixed(2)} m\n`;
    });

    output += `\n  Suma dociÄ™tych dÅ‚ugoÅ›ci: ${totalCut.toFixed(2)} m\n`;
    output += `  Suma dostÄ™pnych dÅ‚ugoÅ›ci (belki): ${totalStock.toFixed(2)} m\n`;
    output += `  Suma odpadÃ³w: ${totalWaste.toFixed(2)} m\n\n`;
  }

  output += `\n=========================\nðŸ“Š PODSUMOWANIE GLOBALNE\n=========================\n`;
  output += `ðŸ”¸ ÅÄ…czna iloÅ›Ä‡ ciÄ™Ä‡: ${globalCuts}\n`;
  output += `ðŸ”¸ ÅÄ…czna dÅ‚ugoÅ›Ä‡ ciÄ™Ä‡: ${globalLength.toFixed(2)} m\n`;
  output += `ðŸ”¸ ÅÄ…czna iloÅ›Ä‡ belek: ${globalBeams}\n`;
  output += `ðŸ”¸ ÅÄ…czny odpad: ${globalWaste.toFixed(2)} m\n`;

  resultDiv.textContent = output.trim();
}

document.getElementById('inputData').addEventListener('input', () => {
  calculate();
});
</script>
</body>
</html>
